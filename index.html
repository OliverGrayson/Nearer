<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Nearer</title>
    <link rel="stylesheet" href="./assets/fonts.css" />
    <link rel="stylesheet" href="./assets/style.css" />
  </head>
  <body>
    <script>
    window.$ = window.jQuery = require('jquery');
    const moment = require('moment');
    const ipcRenderer = require('electron').ipcRenderer;

    ipcRenderer.on('vid-info', (event, info) => {
      console.log(info);
      $('#song-title').text(info.title);
      $('#thumb').attr('src', info.thumbnail_url);
      $('#total-time').text(moment.utc(info.length_seconds * 1000).format('HH:mm:ss'));
    });

    ipcRenderer.on('vid-update', (event, info) => {
      $('#current-time').text(moment.utc(info.time_millis).format('HH:mm:ss'));
    });

    ipcRenderer.on('vid-done', () => {
      $('#song-title').text('No Song Playing');
      $('#thumb').attr('src', 'http://via.placeholder.com/200x150?text=?');
      $('#total-time').text('N/A');
      $('#current-time').text('N/A');
    });

    ipcRenderer.on('connected', () => {
      $('#connection-status').text('☑');
      $('#connection-status').css({'color': '#0A0'});
      $('#nearer-status').text('Getting status...');
    });

    ipcRenderer.on('status', (event, info) => {
      $('#nearer-status').text(info.status);
    });

    ipcRenderer.on('ping', (event, ping) => {
      $('#ping').text(ping.toFixed(1));
    });

    ipcRenderer.on('disconnected', () => {
      $('#connection-status').text('☒');
      $('#connection-status').css({'color': '#A00'});
    });

    function nearer(endpoint) {
      fetch(`http://localhost:5000/${endpoint}`);
    }
    </script>

    <img id="thumb" src="http://via.placeholder.com/200x150?text=?" />

    <div id="side">
      <table style="width: 100%; margin-left: 7px">
        <tr>
          <th>Title:</th>
          <td id="song-title">No Song Playing</td>
        </tr>
        <tr>
          <th>Progress:</th>
          <td id="song-progress">
            <a id="current-time">N/A</a> of <a id="total-time">N/A</a>
          </td>
        </tr>
        <tr>
          <th>Status:</th>
          <td id="nearer-status">Unknown</td>
        </tr>
      </table>
      <p style="margin-left: 5px; margin-right: auto">
        Ping: <a id="ping">?</a> ms
      </p>
    </div>

    <div id="bottom">
      <button class="nice-button" onclick="nearer('pause')">Pause</button>
      <button class="nice-button" onclick="nearer('resume')">Resume</button>
      <button class="nice-button" onclick="nearer('skip')">Skip</button>
      <button class="nice-button" onclick="ipcRenderer.send('reconnect');">Reconnect</button>
      <header style="margin-left: auto">
        <h2 style="display: inline;">Connection: </h2>
        <h2 id="connection-status" style="color: #A00; display: inline;">☒</h2>
      </header>
    </div>
  </body>
</html>
